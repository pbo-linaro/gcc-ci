on:
  push:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build_gcc:
    env:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        revision: [master, ff35f1d4daa37e74f7a68e87c1a6c180d9a91f10, c822ad86984e752734b9c371f9cfef9330334ec4, 35ba3add7d0a9fc6ce955ba8ad82b0413e86ad7d, ead2b94d602ce758575aa46ec35a51c3157ff9cd, b24c09bfb626271cda345f5a6f0d3a6b6480593d, d6840b3143f617065a070857cb22d826d24c622b, c535360788e142a92e1d8b1db25bf4452e26f5fb, 3333a064e4925afa1ad5f2f8c1350c4f57d631ce, e8018ccff9aa9686d00a4bfe42448d517c699964]
        #latest: [b7e4a4c626eeeb32c291d5bbbaa148c5081b6bfd]
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - run: ./build_gcc.sh ${{ matrix.revision }} docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
      - run: podman login docker.io -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD
      - run: podman push docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
