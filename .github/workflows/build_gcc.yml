on:
  push:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build_gcc:
    env:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        revision: [master, 91e9e8faea4086b3b8aef2355fc12c1559d425f6, bac33a522bb51e30729191e935f25c2b0a63e225, ef9754dfdf18a89de3da23c4f23365f4c2611367, f5745dc1426bdb1a53ebaf7af758b2250ccbff02, a98a39328643e092aa6f0d98586a9b7f92bfff91, bc7546e32c5a942e240ef97776352d21105ef291, 5ddf651ad91d34b754dbe280e5ab2b19cf90f8ee, bbdb72ba29ead4931a6cfff023c0485fa25e648b, 3fa689f6ed8387d315e58169bb9bace3bd508c0a]
        #latest: [330f1e078dae257d4f8f7b13299ececc2344e681]
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - run: ./build_gcc.sh ${{ matrix.revision }} docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
      - run: podman login docker.io -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD
      - run: podman push docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
