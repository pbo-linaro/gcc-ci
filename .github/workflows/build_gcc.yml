on:
  push:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build_gcc:
    env:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        revision: [master, 1ae71269890f532a2bb06b84fc49f474c16e230d, ae034b9106fbdd855ec22ce221bb61a1a9a532c3, 2ef5200a6fb7311074904a1b4bf7ce750618a068, 0c773209fc9d0b5fa04f4055bdc2ff9746a1999d, 3fa0f9404b1bcd5a47629d4e121390603039f951, 29ad35a1db645f6027acc4f2a9b15363f402ca97, fe54b57728c09ab0389e2bb3f079d5210566199d, f998335ac0aa56261789282cba5ae1286ddf3a1f, c7ef2189855a8cf12427a778cd5a31d42ddf6260]
        #latest: [5fa27d9f8c4bec65887654e374146926d76690b0]
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - run: ./build_gcc.sh ${{ matrix.revision }} docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
      - run: podman login docker.io -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD
      - run: podman push docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
