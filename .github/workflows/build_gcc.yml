on:
  push:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build_gcc:
    env:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        revision: [master, 8cfc28040ec622a9fbd4b91c1520b1d2688f24eb, 0a5170b5f596bb5fcedf25d93952b979d02d1f56, e5e1999aa664333f766f3e6cc6996f769d50ae7a, 767e2674875139ac8f354ceee655c1a9561b9779, 95b70545331764c85079a1d0e1e19b605bda1456, 8afdbcdd7abe1e3c7a81e07f34c256e7f2dbc652, 7b15959f8e35b821ebfe832a36e5e712b708dae1, 8cccdc2176740f3e034ee6caa49552cf2f142744, 5fa27d9f8c4bec65887654e374146926d76690b0]
        #latest: [7d00a59229ee17af009a3c6c6208b0611740ed49]
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - run: ./build_gcc.sh ${{ matrix.revision }} docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
      - run: podman login docker.io -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD
      - run: podman push docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
