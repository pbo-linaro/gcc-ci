on:
  push:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build_gcc:
    env:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        revision: [master, 924ed118020af695dd54a8a7ec42176f336b4d62, 0bd6f7a7496a78832624713f3df64ad17fa0f841, 94415eb7a464e855c37ab01ab300fa5e87e4c4a3, b73a685ebf498af62f6a8743303c20fcdee827a1, fcdd2757c76bf925115b8e1ba4318d6366dd6f09, d7ee988c491cde43d04fe25f2b3dbad9d85ded45, c0911c6b357ba916ae24926b7d8b9ca35234f33c, a1f0d227481fe143f8c15b3f268e2d5964a3c90a, 082835836cf763e74ed2fdf9645ac4f1f94d6d4f]
        #latest: [635093595ff5ffbcab74a0d63584daf51537c542]
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - run: ./build_gcc.sh ${{ matrix.revision }} docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
      - run: podman login docker.io -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD
      - run: podman push docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
