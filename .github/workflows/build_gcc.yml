on:
  push:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build_gcc:
    env:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        revision: [master, 723d62feae96fb528d5faf715fe2ff47233670a0, 14876d6aa73b9e9385313c857ab6f399e4823bf8, e0fe3ab96848633e1e09f20ddbf32bdb6552db11, ea54b390aed306d10f79adf6ef4626ebeef901df, 8d30107455f2309854ced3d65fb07dc1f2c357c0, 06f64b95bafc06c318efc7b6d7c03cd34fe4be78, 2c200a12c12f84a4d373aafaae8ff01fb0381b46, b26bbd1be31666c2cc83527e89dba6684d97735b, 73d5d3e2b29a3ebd538b6e55f0c8d62621342317]
        #latest: [082835836cf763e74ed2fdf9645ac4f1f94d6d4f]
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - run: ./build_gcc.sh ${{ matrix.revision }} docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
      - run: podman login docker.io -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD
      - run: podman push docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
