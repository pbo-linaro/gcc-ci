on:
  push:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build_gcc:
    env:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        revision: [master, 4bfafea6922dffea145d1aa1d5f5fa4814e66173, afead7fb9b3113dbc3dc84e514847f8b688742bf, 9b4f535e45764163e78c9004b1b37dbe5168a1e6, a52940cfee0908aed0d2a674a451f6d99844444d, e7b3cf2a0e34813eb538e2bf8b6a73e4479c6d31, 7304e85ffff8cd832bb520f2b4f341fca286d510, 5641787abeea0fdc8fc43733e01768caad25b761, d50d3d0a688e8dac31b307b3aad3fbc99283ebc4, 330f1e078dae257d4f8f7b13299ececc2344e681]
        #latest: [c7ef2189855a8cf12427a778cd5a31d42ddf6260]
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - run: ./build_gcc.sh ${{ matrix.revision }} docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
      - run: podman login docker.io -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD
      - run: podman push docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
