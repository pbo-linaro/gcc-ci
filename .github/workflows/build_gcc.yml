on:
  push:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build_gcc:
    env:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        revision: [master, 943fd92254cccbfb5cd8bb0203ce47302afde319, e6bb4d997953d3ad28082a1dccb69657c6f441d9, 392f70cc11089f6da2611177de5f3e8baad6d327, 4c12bcbeb0c0fd6da4c56e7622814201daadd585, d2b269ce30d77dbfc6c28c75887c330d4698b132, 52b4b7d7f5c7c09f5aaf3934978de9702d8c214b, 958940eb3511e341e57606f5a2f5399bc89533cb, e0659b5417b7f8a090ad2ed4dea830f11ef9c877, 90bc2d09b5bfcc913f79543c3b65202e7246e162]
        #latest: [348874f0baac0f22c98ab11abbfa65fd172f6bdd]
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - run: ./build_gcc.sh ${{ matrix.revision }} docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
      - run: podman login docker.io -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD
      - run: podman push docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
