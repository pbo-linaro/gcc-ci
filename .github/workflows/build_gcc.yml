on:
  push:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build_gcc:
    env:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        revision: [master, acfd33620af3519b84baecedb0eb6618c2f599a6, 5e0f67b84a615ba186ab234a9bc43df0df5a50b6, 7ff33c609a64319583223d6d39a89e971f993ecf, 585dc19ef051959d688e6ea89b41998600480ecb, d16479170066b7606dea8dc25a7527a081a90a0b, 9e20779a7d8e14e77df6efaeadc6bf3a001336ef, e9f0af150358d93b4c4c5f65d662748ae87bd3d0, be0ff0866a6f072ccfbbb3a3c2079adf1db51aa1, 96e1978b213482fc4c25693b91ae2ead481af620]
        #latest: [e8018ccff9aa9686d00a4bfe42448d517c699964]
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - run: ./build_gcc.sh ${{ matrix.revision }} docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
      - run: podman login docker.io -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD
      - run: podman push docker.io/pbolinaro/gcc-ci:${{ matrix.revision }}
